type: json
data:
  url: /_nodes/stats/jvm?format=smile
  server: ${ST_MONITOR_ES_NODE_HOSTPORT}
  basicHttpAuthUsername: ${ST_MONITOR_ES_NODE_BASICAUTH_USERNAME}
  basicHttpAuthPassword: ${ST_MONITOR_ES_NODE_BASICAUTH_PASSWORD}
  smileFormat: true

observation:
  - name: jvmMemoryStats_memory
    metricNamespace: jvm
    path: $.nodes.${nodeId}.jvm.mem

    metric:
      - name: heap.used
        source: heap_used_in_bytes
        type: gauge
        label: heap_used
        description: jvm heap used memory
        unit: bytes

      - name: heap.committed
        source: heap_committed_in_bytes
        type: gauge
        label: heap.committed
        description: jvm heap committed
        unit: bytes

      - name: nonheap.used
        source: non_heap_used_in_bytes
        type: gauge
        label: non_heap_used
        description: jvm non-heap used memory
        unit: bytes

      - name: nonheap.committed
        source: non_heap_committed_in_bytes
        type: gauge
        label: non_heap_committed
        description: jvm non-heap committed
        unit: bytes

    tag:
      - name: es.node.id
        value: ${nodeId}
        
      - name: es.node
        value: json:smile:/_cluster/state/nodes?local=true&format=smile $.nodes.${nodeId}.name

      - name: es.node.role
        value: json:smile:/_cluster/state/nodes?local=true&format=smile $.nodes.${nodeId}.roles return:ConcatCollection()


